# Concepts

## 值类型和引用类型以及存储的位置
- 值类型
  - 变量直接存储数据
  - 数据存储在线程栈（stack）中;
  - 赋值，赋的是值;
  - 作为参数，传入的是值;
- 引用类型
  - 变量存储的是数据的地址
  - 数据存储在托管堆（heap）中;
  - 赋值，赋的是引用地址;
  - 作为参数，传入的是引用地址;

## 什么是装箱和拆箱？
- 装箱
  - 把值类型转换为引用类型;
- 拆箱
  - 把引用类型（被装箱的对象）转换为值类型;

## 箱子是什么？
- 引用类型的对象

## 装箱拆箱的性能影响
- 装箱拆箱涉及了内存的分配和对象的创建
  - 装箱的过程
    - ***申请内存***，在 **托管堆** 中申请大小等于值类型的大小，再加上固定的额外空间（引用类型的标配：TypeHandle和同步索引块）的内存;
    - ***字段值拷贝***，把线程栈上的值类型的 **字段值** 拷贝到新申请的内存中;
    - ***返地址***，返回新引用类型对象的地址;
  - 拆箱的过程
    - ***有效性***，实例对象是否有效，其装箱的类型与拆箱的 **类型是否一致**，如果非法则抛出异常;
    - ***取地址***，获取引用类型对象中 **字段值的地址**;
    - ***字段值拷贝***，把引用类型对象中的字段值取出拷贝到栈上，即在栈上新创建一个值类型的对象存储拆箱后的值;

## Class与Struct的区别，以及何时使用？
- class是引用类型，
  - 默认访问权限是private;
  - 可以显式声明无参数构造函数;
  - 支持继承;
  - 可以在声明的时候初始化;
- struct是值类型，
  - 默认访问权限是public;
  - 不能显式声明无参数构造函数;
  - 不能继承，但支持接口;
  - 除非字段为声明为const或static，否则不能在声明的时候初始化;

- 使用策略
  - 多数情况下，推荐使用class，因为class在类的赋值，作为参数传入，作为返回值，实际上拷贝的都是托管堆上的地址，只占用4字节；
  - 而struct在赋值，传参，返回值上都是完全拷贝，会占用栈上的资源;
    - 当字节数小于14，偏向于值而不是偏向与对象，希望值不变的情况下，推荐使用struct;
- 参考链接
  
    https://blog.csdn.net/qiaoquan3/article/details/51234208

